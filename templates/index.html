<!doctype html>
<html lang="{{ lang }}" dir="{{ lang_dir }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ page_title }}</title>
  <meta name="description" content="{{ page_description }}">
  <meta name="keywords" content="{{ t.meta_keywords }}">
  <meta name="robots" content="index, follow">
  <meta property="og:title" content="{{ page_title }}">
  <meta property="og:description" content="{{ page_description }}">
  <meta property="og:type" content="website">
  <link rel="canonical" href="{{ base_url }}/{{ lang }}{% if page_slug %}/{{ page_slug }}{% endif %}">
  {% for code, _label in languages %}
    <link rel="alternate" hreflang="{{ code }}" href="{{ base_url }}/{{ code }}{% if page_slug %}/{{ page_slug }}{% endif %}">
  {% endfor %}
  <link rel="alternate" hreflang="x-default" href="{{ base_url }}/{{ default_lang }}{% if page_slug %}/{{ page_slug }}{% endif %}">
  <link rel="stylesheet" href="/static/style.css">
</head>
<body data-lang="{{ lang }}" data-page-slug="{{ page_slug }}">
  <div class="page">
    <header class="topbar">
      <div class="topbar-main">
        <div class="brand">
          <span class="brand-dot"></span>
          <span>{{ t.brand }}</span>
        </div>
        <button class="menu-toggle" type="button" id="menuToggle" aria-expanded="false" aria-controls="topbarActions" aria-label="Toggle menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div class="topbar-actions" id="topbarActions">
        <a class="home-btn" href="{{ url_for('index', lang=lang) }}">{{ t.home }}</a>
        <form class="lang-select" method="get" action="/">
          <label class="lang-label" for="langSelect">{{ t.language_label }}</label>
          <select id="langSelect" name="lang">
            {% for code, label in languages %}
              <option value="{{ code }}" {% if code == lang %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </form>
      </div>
    </header>

    <nav class="media-tabs" aria-label="Media types">
      <button class="tab{% if selected_type in [None, 'video'] %} active{% endif %}" type="button" data-type="video" data-label="{{ t.headline_video }}">
        <span class="tab-icon icon-video" aria-hidden="true"></span>
        {{ t.tab_video }}
      </button>
      <button class="tab{% if selected_type == 'reels' %} active{% endif %}" type="button" data-type="reels" data-label="{{ t.headline_reels }}">
        <span class="tab-icon icon-reels" aria-hidden="true"></span>
        {{ t.tab_reels }}
      </button>
      <button class="tab{% if selected_type == 'photo' %} active{% endif %}" type="button" data-type="photo" data-label="{{ t.headline_photo }}">
        <span class="tab-icon icon-photo" aria-hidden="true"></span>
        {{ t.tab_photo }}
      </button>
    </nav>

    <main class="content">
      <section class="card">
        <p class="kicker">{{ t.kicker }}</p>
        <h1 id="headline">
          {% if selected_type == 'reels' %}{{ t.headline_reels }}
          {% elif selected_type == 'photo' %}{{ t.headline_photo }}
          {% else %}{{ t.headline_video }}
          {% endif %}
        </h1>
        <p class="sub">{{ t.sub }}</p>

        {% if error %}
          <div class="alert">{{ error }}</div>
        {% endif %}

        <form method="post" action="{{ post_url }}" class="search" id="downloadForm">
          <input type="hidden" name="media_type" id="mediaType" value="{{ selected_type or 'video' }}">

          <div class="search-row">
            <label class="search-field">
              <span class="link-icon" aria-hidden="true"></span>
              <input
                type="text"
                name="media_url"
                id="targetInput"
                placeholder="{{ t.placeholder }}"
                autocomplete="off"
                required
              >
            </label>
            <button class="chip" type="button" id="pasteBtn">{{ t.paste }}</button>
          </div>

          <div class="search-actions">
            <button class="cta" type="submit">
              <span class="loader" aria-hidden="true"></span>
              {{ t.search }}
            </button>
            <button class="chip ghost" type="button" id="clearBtn">{{ t['clear'] }}</button>
          </div>
        </form>

        {% if items %}
          <div class="results" id="results">
            <h2>{{ t.results }}</h2>
            <div class="media-grid" data-mode="{{ selected_type or '' }}">
              {% for item in items %}
                <div class="media-card" data-mode="{{ selected_type or '' }}">
                  <div class="media-frame">
                    {% if item.type == "video" %}
                      <video class="media-preview media-video" controls playsinline preload="metadata" src="{{ url_for('media_proxy', url=item.url) }}"></video>
                    {% else %}
                      <img class="media-preview media-image" src="{{ url_for('media_proxy', url=item.url) }}" alt="{{ t.preview_alt }}">
                    {% endif %}
                  </div>
                  <a class="download-btn" href="{{ url_for('download_file', url=item.url, name=item.name) }}">{{ t.download }}</a>
                </div>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        <section class="seo">
          <h2>{{ seo_title }}</h2>
          {% for paragraph in seo_paragraphs %}
            <p>{{ paragraph }}</p>
          {% endfor %}
          <h3>{{ t.seo_list_title }}</h3>
          <ul>
            <li>{{ t.seo_list_1 }}</li>
            <li>{{ t.seo_list_2 }}</li>
            <li>{{ t.seo_list_3 }}</li>
            <li>{{ t.seo_list_4 }}</li>
          </ul>
        </section>
      </section>
    </main>
  </div>

  <footer class="footer">
    <div class="footer-links">
      <a href="{{ url_for('contact', lang=lang) }}">{{ t.footer_contact }}</a>
      <a href="{{ url_for('about', lang=lang) }}">{{ t.footer_about }}</a>
      <a href="{{ url_for('privacy', lang=lang) }}">{{ t.footer_privacy }}</a>
    </div>
    <p class="footer-disclaimer">{{ t.footer_disclaimer }}</p>
    <p class="footer-copy">{{ t.footer_copy }}</p>
  </footer>

  <div class="modal{% if modal_show %} show{% endif %}" id="statusModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-card">
      <h2 id="modalTitle">{{ modal_title or '' }}</h2>
      <p>{{ modal_message or '' }}</p>
      <button class="cta" type="button" id="closeModal">OK</button>
    </div>
  </div>

  <div class="loading-overlay" id="loadingOverlay" aria-live="polite" aria-busy="true">
    <div class="loading-card">
      <div class="loading-spinner" aria-hidden="true"></div>
      <h3>Fetching media...</h3>
      <p>Please wait while we load your preview.</p>
    </div>
  </div>

  <script>
    const tabs = document.querySelectorAll('.tab');
    const mediaType = document.getElementById('mediaType');
    const headline = document.getElementById('headline');
    const currentLang = document.body.dataset.lang;

    const slugMap = {
      video: 'video-download',
      reels: 'reels-download',
      photo: 'photo-download'
    };

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const type = tab.dataset.type;
        const slug = slugMap[type] || '';
        window.location.href = '/' + currentLang + '/' + slug;
      });
    });

    const pasteBtn = document.getElementById('pasteBtn');
    const clearBtn = document.getElementById('clearBtn');
    const targetInput = document.getElementById('targetInput');
    const form = document.getElementById('downloadForm');
    const loader = form.querySelector('.loader');

    pasteBtn.addEventListener('click', async () => {
      try {
        const text = await navigator.clipboard.readText();
        if (text) targetInput.value = text.trim();
      } catch (err) {
        alert('Clipboard access blocked. Paste manually.');
      }
    });

    clearBtn.addEventListener('click', () => {
      targetInput.value = '';
      targetInput.focus();
    });

    form.addEventListener('submit', () => {
      loader.classList.add('spin');
      const loadingOverlay = document.getElementById('loadingOverlay');
      if (loadingOverlay) loadingOverlay.classList.add('show');
    });

    const modal = document.getElementById('statusModal');
    const closeModal = document.getElementById('closeModal');
    if (modal.classList.contains('show')) {
      closeModal.addEventListener('click', () => modal.classList.remove('show'));
    }

    const langSelect = document.getElementById('langSelect');
    if (langSelect) {
      langSelect.addEventListener('change', () => {
        const selected = langSelect.value;
        const slug = document.body.dataset.pageSlug;
        const path = slug ? '/' + selected + '/' + slug : '/' + selected;
        window.location.href = path;
      });
    }

    const menuToggle = document.getElementById('menuToggle');
    const topbar = document.querySelector('.topbar');
    if (menuToggle && topbar) {
      menuToggle.addEventListener('click', () => {
        const isOpen = topbar.classList.toggle('menu-open');
        menuToggle.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
      });
    }

    const results = document.getElementById('results');
    if (results) {
      setTimeout(() => {
        results.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 150);
    }
  </script>
</body>
</html>
